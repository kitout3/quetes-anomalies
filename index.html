<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>QuÃªtes d'Anomalies - Multijoueur</title>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div id="root"></div>
  <script>
const { useState, useEffect, useMemo } = React;
const { createRoot } = ReactDOM;

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDvJGCtvxuRXCxmZfGsvmQ_BMITdlYlq78",
  authDomain: "quetes-anomalies.firebaseapp.com",
  databaseURL: "https://quetes-anomalies-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "quetes-anomalies",
  storageBucket: "quetes-anomalies.firebasestorage.app",
  messagingSenderId: "853208154430",
  appId: "1:853208154430:web:ce645069e035c1aa0aac6f"
};

let auth, database;
try {
  firebase.initializeApp(firebaseConfig);
  auth = firebase.auth();
  database = firebase.database();
  console.log("Firebase initialisÃ©");
} catch (e) { console.error("Erreur Firebase:", e); }

// Constantes
const STAT_NAMES = { endurance: "Endurance", force: "Force", vitesse: "Vitesse", perception: "Perception", sagesse: "Sagesse", intelligence: "Intelligence" };
const STAT_MAPPING = { "Endurance": "endurance", "Force": "force", "Vitesse": "vitesse", "Perception": "perception", "Sagesse": "sagesse", "Intelligence": "intelligence" };
const STATISTIQUES = ["Endurance", "Force", "Vitesse", "Perception", "Sagesse", "Intelligence"];

const PDV_SOURCES = {
  KILL: { label: "Ã‰limination", emoji: "ðŸ’€", color: "text-red-600" },
  QUEST_COMBAT: { label: "QuÃªte combat", emoji: "âš”ï¸", color: "text-orange-600" },
  QUEST_EXCHANGE: { label: "QuÃªte Ã©change", emoji: "ðŸ”„", color: "text-blue-600" },
  TERRITORY: { label: "Territoire", emoji: "ðŸ°", color: "text-green-600" },
  BOSS: { label: "Boss", emoji: "ðŸ‰", color: "text-yellow-600" },
  START: { label: "Passage DÃ©part", emoji: "ðŸ", color: "text-teal-600" },
  BONUS: { label: "Bonus", emoji: "âœ¨", color: "text-pink-600" }
};

const BIOMES = {
  FORET: { name: "ForÃªt CuivrÃ©e", resource: "cuivre", emoji: "ðŸŒ³" },
  DESERT: { name: "DÃ©sert ArgentÃ©", resource: "argent", emoji: "ðŸœï¸" },
  MONTAGNE: { name: "Montagne Obsidienne", resource: "obsidienne", emoji: "â›°ï¸" }
};

const BOSSES = {
  FORET: { name: "Gardien de la ForÃªt", difficulty: 6, pdv: 3, emoji: "ðŸŒ²" },
  DESERT: { name: "Titan du DÃ©sert", difficulty: 8, pdv: 4, emoji: "ðŸœï¸" },
  MONTAGNE: { name: "Seigneur de la Montagne", difficulty: 10, pdv: 5, emoji: "â›°ï¸" }
};

const OBJECTIVES = [
  { id: 'OBJ_OR', resource: 'or', amount: 12, pdv: 3, label: '12 Or', emoji: 'ðŸ’°' },
  { id: 'OBJ_CUIVRE', resource: 'cuivre', amount: 9, pdv: 3, label: '9 Cuivre', emoji: 'ðŸ¥‰' },
  { id: 'OBJ_ARGENT', resource: 'argent', amount: 6, pdv: 3, label: '6 Argent', emoji: 'ðŸ¥ˆ' },
  { id: 'OBJ_OBSIDIENNE', resource: 'obsidienne', amount: 3, pdv: 3, label: '3 Obsidienne', emoji: 'â¬›' }
];

const EXCHANGE_RATES = { cuivre: { toOr: 2 }, argent: { toOr: 3 }, obsidienne: { toOr: 4 } };
const RESOURCE_MAPPING = { "PiÃ¨ce d'Or": { key: "or" }, "Ecorce CuivrÃ©e": { key: "cuivre" }, "Sable ArgentÃ©": { key: "argent" }, "Roche Obsidienne": { key: "obsidienne" } };

// Rules Engine
const rulesEngine = {
  getAttackBonus: (player, ctx) => {
    let bonus = 0;
    if (player.characterKey === 'CHASSEUR' && (ctx.type === 'QUEST' || ctx.isRanged)) bonus += 1;
    if (player.characterKey === 'CHEVALIER' && ctx.type === 'TERRITORY' && ctx.isNeutral) bonus += 1;
    return { bonus };
  },
  getHealOnSuccess: (attacker) => attacker.characterKey === 'HOMME_BETE' ? 2 : 0,
  getQuestBonus: (player) => player.characterKey === 'VICAIRE' ? 1 : 0,
  getStartGold: (charKey) => charKey === 'MARCHAND' ? 14 : 10,
  getPassBonus: (player) => player.characterKey === 'MARCHAND' ? { or: 4 } : {},
  canSacrificePv: (player) => player.characterKey === 'HOMME_BETE',
  canReroll: (player) => player.characterKey === 'VICAIRE'
};

// Personnages
const CHARACTERS = {
  CHASSEUR: { key: "CHASSEUR", name: "Le Chasseur", emoji: "ðŸ¹", pvMax: 6, role: "Harceleur â€“ Distance", skills: ["Attaque Ã  distance", "Pas de riposte Ã  distance", "+1 attaques Ã  distance"] },
  MARCHAND: { key: "MARCHAND", name: "Le Marchand", emoji: "ðŸª™", pvMax: 6, role: "Ã‰conomie â€“ Monopoles", skills: ["+4 Or au dÃ©part et passage DÃ©part", "AchÃ¨te territoires avec or", "+1 PDV/monopole fin"] },
  HOMME_BETE: { key: "HOMME_BETE", name: "L'Homme-bÃªte", emoji: "ðŸº", pvMax: 10, role: "Berserker â€“ Tank", skills: ["Sacrifie PV â†’ bonus jet", "+2 PV sur victoire", "Riposte 1 dÃ©gÃ¢t"] },
  CHEVALIER: { key: "CHEVALIER", name: "Le Chevalier", emoji: "âš”ï¸", pvMax: 10, role: "ConquÃªte â€“ Territoires", skills: ["Capture territoire adverse", "+1 vs territoires neutres", "+1 PDV/biome fin"] },
  VICAIRE: { key: "VICAIRE", name: "Le Vicaire", emoji: "âœ¨", pvMax: 8, role: "Support â€“ Optimisation", skills: ["Relance stat (1 ressource)", "BÃ©nÃ©diction +2 (2 ress.)", "+1 PDV/quÃªte"] },
  HERETIQUE: { key: "HERETIQUE", name: "L'HÃ©rÃ©tique", emoji: "ðŸ’€", pvMax: 8, role: "Sabotage â€“ Assassinat", skills: ["Choisit stat vs joueur", "MalÃ©diction -2 (3 PV)", "+1 PDV kill maudit"] }
};

// Cartes
const ANOMALIES = [
  "Soignez 2 [Point de vie].", "Soignez 4 [Point de vie].", "Soignez 6 [Point de vie].",
  "Perdez 2 [Point de vie].", "Perdez 4 [Point de vie].", "Perdez 6 [Point de vie].",
  "Obtenez [BÃ©nÃ©diction].", "Obtenez [BÃ©nÃ©diction].", "Obtenez [MalÃ©diction].", "Obtenez [MalÃ©diction].",
  "Gagnez 8 [PiÃ¨ce d'Or].", "Gagnez 4 [PiÃ¨ce d'Or].",
  "Gagnez 6 [Ecorce CuivrÃ©e].", "Gagnez 3 [Ecorce CuivrÃ©e].",
  "Gagnez 4 [Sable ArgentÃ©].", "Gagnez 2 [Sable ArgentÃ©].",
  "Gagnez 2 [Roche Obsidienne].", "Gagnez 1 [Roche Obsidienne].",
  "Perdez 4 [PiÃ¨ce d'Or].", "Perdez 3 [Ecorce CuivrÃ©e].", "Perdez 2 [Sable ArgentÃ©].",
  "Recharger votre pouvoir."
];

const QUETES = [
  "Dans le territoire [ForÃªt aux arbres CuivrÃ©s], Ã©liminer la crÃ©ature de difficultÃ© 6 pour gagner 3 [Point de victoire].",
  "Dans le territoire [ForÃªt aux arbres CuivrÃ©s], Ã©liminer la crÃ©ature de difficultÃ© 8 pour gagner 4 [Point de victoire].",
  "Dans le territoire [DÃ©sert aux sables ArgentÃ©s], Ã©liminer la crÃ©ature de difficultÃ© 6 pour gagner 3 [Point de victoire].",
  "Dans le territoire [DÃ©sert aux sables ArgentÃ©s], Ã©liminer la crÃ©ature de difficultÃ© 8 pour gagner 4 [Point de victoire].",
  "Dans le territoire [Montagne aux roches Obsidiennes], Ã©liminer la crÃ©ature de difficultÃ© 6 pour gagner 3 [Point de victoire].",
  "Dans le territoire [Montagne aux roches Obsidiennes], Ã©liminer la crÃ©ature de difficultÃ© 10 pour gagner 5 [Point de victoire].",
  "Echanger 8 [PiÃ¨ce d'Or] contre 2 [Point de victoire].",
  "Echanger 4 [PiÃ¨ce d'Or] contre 1 [Point de victoire].",
  "Echanger 6 [Ecorce CuivrÃ©e] contre 2 [Point de victoire].",
  "Echanger 3 [Ecorce CuivrÃ©e] contre 1 [Point de victoire].",
  "Echanger 4 [Sable ArgentÃ©] contre 2 [Point de victoire].",
  "Echanger 2 [Sable ArgentÃ©] contre 1 [Point de victoire].",
  "Echanger 2 [Roche Obsidienne] contre 2 [Point de victoire].",
  "Echanger 1 [Roche Obsidienne] contre 1 [Point de victoire]."
];

// Utilitaires
const genCode = () => { const c = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789"; let r = ""; for (let i = 0; i < 6; i++) r += c[Math.floor(Math.random() * c.length)]; return r; };

const getRandomAvailableResource = (player) => {
  const a = [];
  if (player.or > 0) a.push('or');
  if (player.cuivre > 0) a.push('cuivre');
  if (player.argent > 0) a.push('argent');
  if (player.obsidienne > 0) a.push('obsidienne');
  return a.length ? a[Math.floor(Math.random() * a.length)] : null;
};

function parseAnomaly(text) {
  let m;
  if (m = text.match(/Soignez (\d+)/)) return { type: 'heal', amount: +m[1] };
  if (m = text.match(/Perdez (\d+) \[Point de vie\]/)) return { type: 'damage', amount: +m[1] };
  if (text.includes('[BÃ©nÃ©diction]')) {
    const stats = Object.keys(STAT_NAMES);
    return { type: 'bless', stat: stats[Math.floor(Math.random() * stats.length)] };
  }
  if (text.includes('[MalÃ©diction]')) {
    const stats = Object.keys(STAT_NAMES);
    return { type: 'curse', stat: stats[Math.floor(Math.random() * stats.length)] };
  }
  if (m = text.match(/Gagnez (\d+) \[PiÃ¨ce/)) return { type: 'gain', resource: 'or', amount: +m[1] };
  if (m = text.match(/Gagnez (\d+) \[Ecorce/)) return { type: 'gain', resource: 'cuivre', amount: +m[1] };
  if (m = text.match(/Gagnez (\d+) \[Sable/)) return { type: 'gain', resource: 'argent', amount: +m[1] };
  if (m = text.match(/Gagnez (\d+) \[Roche/)) return { type: 'gain', resource: 'obsidienne', amount: +m[1] };
  if (m = text.match(/Perdez (\d+) \[PiÃ¨ce/)) return { type: 'lose', resource: 'or', amount: +m[1] };
  if (m = text.match(/Perdez (\d+) \[Ecorce/)) return { type: 'lose', resource: 'cuivre', amount: +m[1] };
  if (m = text.match(/Perdez (\d+) \[Sable/)) return { type: 'lose', resource: 'argent', amount: +m[1] };
  if (m = text.match(/Perdez (\d+) \[Roche/)) return { type: 'lose', resource: 'obsidienne', amount: +m[1] };
  if (text.includes('Recharger')) return { type: 'recharge' };
  return { type: 'other' };
}

function parseQuest(text) {
  const pdvMatch = text.match(/(\d+) \[Point de victoire\]/);
  const pdv = pdvMatch ? +pdvMatch[1] : 0;
  const exchMatch = text.match(/Echanger (\d+) \[(.+?)\] contre/);
  if (exchMatch) {
    const resInfo = RESOURCE_MAPPING[exchMatch[2]];
    return { pdv, isExchange: true, isCombat: false, resourceKey: resInfo?.key, resourceAmount: +exchMatch[1] };
  }
  const combatMatch = text.match(/difficultÃ© (\d+) pour gagner/);
  if (combatMatch) {
    const statKeys = Object.keys(STAT_NAMES);
    return { pdv, isExchange: false, isCombat: true, difficulty: +combatMatch[1], stat: statKeys[Math.floor(Math.random() * statKeys.length)] };
  }
  return { pdv, isExchange: false, isCombat: false };
}

function countTerritoriesByBiome(territories) {
  const c = { FORET: 0, DESERT: 0, MONTAGNE: 0 };
  (territories || []).forEach(t => { if (c[t.biome] !== undefined) c[t.biome]++; });
  return c;
}

// App Principal
function App() {
  const [screen, setScreen] = useState("menu");
  const [user, setUser] = useState(null);
  const [gameId, setGameId] = useState(null);
  const [game, setGame] = useState(null);
  const [playerName, setPlayerName] = useState("");
  const [joinCode, setJoinCode] = useState("");
  const [notif, setNotif] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    if (!auth) { setLoading(false); setUser({ uid: "local_" + Date.now() }); return; }
    const unsub = auth.onAuthStateChanged((u) => {
      if (u) { setUser({ uid: u.uid }); setLoading(false); }
      else auth.signInAnonymously().then(() => setLoading(false)).catch(e => { console.error(e); setLoading(false); });
    });
    return () => unsub();
  }, []);

  useEffect(() => {
    if (!database || !gameId) return;
    const ref = database.ref("games/" + gameId);
    const cb = ref.on("value", (snap) => {
      const d = snap.val();
      if (d) { setGame(d); if (d.status === "playing" && screen === "lobby") setScreen("game"); }
    });
    return () => ref.off("value", cb);
  }, [gameId, screen]);

  const notify = (msg, type) => { setNotif({ msg, type }); setTimeout(() => setNotif(null), 3000); };

  const createGame = async () => {
    if (!playerName.trim()) return notify("Entrez votre nom", "error");
    const code = genCode();
    const newGame = {
      code: code, hostId: user.uid, status: "waiting",
      players: { [user.uid]: { oderId: user.uid, name: playerName.trim(), isHost: true, charKey: null, stats: null } },
      turnOrder: [], currentTurn: 0, drawnAnomalies: [], drawnQuetes: [], completedObjectives: [], createdAt: Date.now()
    };
    if (database) await database.ref("games/" + code).set(newGame);
    setGameId(code);
    setScreen("lobby");
  };

  const joinGame = async () => {
    if (!playerName.trim() || joinCode.length !== 6) return notify("Nom et code requis", "error");
    const code = joinCode.toUpperCase();
    if (database) {
      const snap = await database.ref("games/" + code).once("value");
      const g = snap.val();
      if (!g) return notify("Partie introuvable", "error");
      if (g.status !== "waiting") return notify("Partie dÃ©jÃ  commencÃ©e", "error");
      if (Object.keys(g.players).length >= 6) return notify("Partie complÃ¨te", "error");
      await database.ref("games/" + code + "/players/" + user.uid).set({ oderId: user.uid, name: playerName.trim(), isHost: false, charKey: null, stats: null });
    }
    setGameId(code);
    setScreen("lobby");
  };

  if (loading) return React.createElement("div", { className: "min-h-screen bg-gradient-to-br from-purple-100 to-blue-100 flex items-center justify-center" },
    React.createElement("div", { className: "w-12 h-12 border-4 border-purple-600 border-t-transparent rounded-full animate-spin" })
  );

  return React.createElement("div", { className: "min-h-screen bg-gradient-to-br from-purple-100 to-blue-100" },
    notif && React.createElement("div", { className: "fixed top-4 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl shadow-lg z-50 " + (notif.type === 'error' ? 'bg-red-500' : 'bg-green-500') + " text-white font-semibold" }, notif.msg),
    screen === "menu" && React.createElement(MenuScreen, { playerName: playerName, setPlayerName: setPlayerName, setScreen: setScreen }),
    screen === "create" && React.createElement(CreateScreen, { playerName: playerName, setPlayerName: setPlayerName, createGame: createGame, setScreen: setScreen }),
    screen === "join" && React.createElement(JoinScreen, { playerName: playerName, setPlayerName: setPlayerName, joinCode: joinCode, setJoinCode: setJoinCode, joinGame: joinGame, setScreen: setScreen }),
    screen === "lobby" && React.createElement(LobbyScreen, { gameId: gameId, game: game, user: user, setScreen: setScreen, notify: notify }),
    screen === "game" && React.createElement(GameScreen, { gameId: gameId, game: game, user: user, notify: notify })
  );
}

// Menu Screen
function MenuScreen(props) {
  return React.createElement("div", { className: "min-h-screen flex items-center justify-center p-6" },
    React.createElement("div", { className: "bg-white rounded-2xl shadow-xl p-8 max-w-md w-full" },
      React.createElement("div", { className: "text-center mb-8" },
        React.createElement("div", { className: "text-5xl mb-4" }, "ðŸŽ²"),
        React.createElement("h1", { className: "text-3xl font-bold text-gray-800 mb-2" }, "QuÃªtes d'Anomalies"),
        React.createElement("p", { className: "text-gray-600" }, "Multijoueur temps rÃ©el")
      ),
      React.createElement("div", { className: "mb-6" },
        React.createElement("label", { className: "block text-sm font-semibold text-gray-700 mb-2" }, "Votre pseudo"),
        React.createElement("input", { type: "text", className: "w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-lg", placeholder: "Entrez votre nom...", value: props.playerName, onChange: function(e) { props.setPlayerName(e.target.value); }, maxLength: 16 })
      ),
      React.createElement("div", { className: "space-y-3" },
        React.createElement("button", { className: "w-full py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-bold text-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50", onClick: function() { props.setScreen("create"); }, disabled: !props.playerName.trim() }, "ðŸŽ® CrÃ©er une partie"),
        React.createElement("button", { className: "w-full py-4 bg-white border-2 border-purple-600 text-purple-600 rounded-xl font-bold text-lg hover:bg-purple-50 disabled:opacity-50", onClick: function() { props.setScreen("join"); }, disabled: !props.playerName.trim() }, "ðŸ”— Rejoindre")
      ),
      React.createElement("p", { className: "text-center text-gray-500 text-sm mt-6" }, "2-6 joueurs â€¢ Tour par tour")
    )
  );
}

// Create Screen
function CreateScreen(props) {
  return React.createElement("div", { className: "min-h-screen flex items-center justify-center p-6" },
    React.createElement("div", { className: "bg-white rounded-2xl shadow-xl p-8 max-w-md w-full" },
      React.createElement("button", { className: "mb-6 text-purple-600 font-semibold", onClick: function() { props.setScreen("menu"); } }, "â† Retour"),
      React.createElement("h2", { className: "text-2xl font-bold text-center mb-6" }, "ðŸŽ® CrÃ©er une partie"),
      React.createElement("div", { className: "mb-6" },
        React.createElement("label", { className: "block text-sm font-semibold text-gray-700 mb-2" }, "Votre nom"),
        React.createElement("input", { type: "text", className: "w-full px-4 py-3 border-2 border-gray-300 rounded-xl", value: props.playerName, onChange: function(e) { props.setPlayerName(e.target.value); } })
      ),
      React.createElement("button", { className: "w-full py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-bold disabled:opacity-50", onClick: props.createGame, disabled: !props.playerName.trim() }, "CrÃ©er la partie")
    )
  );
}

// Join Screen
function JoinScreen(props) {
  return React.createElement("div", { className: "min-h-screen flex items-center justify-center p-6" },
    React.createElement("div", { className: "bg-white rounded-2xl shadow-xl p-8 max-w-md w-full" },
      React.createElement("button", { className: "mb-6 text-purple-600 font-semibold", onClick: function() { props.setScreen("menu"); } }, "â† Retour"),
      React.createElement("h2", { className: "text-2xl font-bold text-center mb-6" }, "ðŸ”— Rejoindre"),
      React.createElement("div", { className: "mb-4" },
        React.createElement("label", { className: "block text-sm font-semibold text-gray-700 mb-2" }, "Votre nom"),
        React.createElement("input", { type: "text", className: "w-full px-4 py-3 border-2 border-gray-300 rounded-xl", value: props.playerName, onChange: function(e) { props.setPlayerName(e.target.value); } })
      ),
      React.createElement("div", { className: "mb-6" },
        React.createElement("label", { className: "block text-sm font-semibold text-gray-700 mb-2" }, "Code de la partie"),
        React.createElement("input", { type: "text", className: "w-full px-4 py-3 border-2 border-gray-300 rounded-xl text-center text-2xl font-bold tracking-widest uppercase", placeholder: "ABC123", value: props.joinCode, onChange: function(e) { props.setJoinCode(e.target.value.toUpperCase()); }, maxLength: 6 })
      ),
      React.createElement("button", { className: "w-full py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-bold disabled:opacity-50", onClick: props.joinGame, disabled: !props.playerName.trim() || props.joinCode.length !== 6 }, "Rejoindre")
    )
  );
}

// Lobby Screen
function LobbyScreen(props) {
  var gameId = props.gameId;
  var game = props.game;
  var user = props.user;
  var notify = props.notify;
  
  if (!game) return React.createElement("div", { className: "min-h-screen flex items-center justify-center" },
    React.createElement("div", { className: "w-12 h-12 border-4 border-purple-600 border-t-transparent rounded-full animate-spin" })
  );

  var players = Object.values(game.players || {});
  var me = players.find(function(p) { return p.oderId === user.uid; });
  var isHost = me && me.isHost;
  var takenChars = players.map(function(p) { return p.charKey; }).filter(Boolean);
  var allReady = players.length >= 2 && players.every(function(p) { return p.charKey && p.stats; });

  var selectChar = function(ck) {
    if (takenChars.includes(ck) && me.charKey !== ck) return;
    if (database) database.ref("games/" + gameId + "/players/" + user.uid + "/charKey").set(ck);
  };

  var startGame = function() {
    if (!isHost || !allReady) return;
    var init = {};
    var order = [];
    Object.entries(game.players).forEach(function(entry, i) {
      var uid = entry[0];
      var p = entry[1];
      var ch = CHARACTERS[p.charKey];
      order.push(uid);
      init[uid] = {
        oderId: p.oderId, name: p.name, isHost: p.isHost, charKey: p.charKey, stats: p.stats,
        index: i, character: ch, characterKey: p.charKey,
        pvCurrent: ch.pvMax, or: rulesEngine.getStartGold(p.charKey),
        cuivre: 0, argent: 0, obsidienne: 0, pdv: 0, pdvHistory: [],
        territories: [], defeatedBosses: [], effects: [], quests: [],
        skills: ch.skills.map(function(s, idx) { return { id: "skill_" + idx, description: s }; }),
        usedAttackDice: false, rerollAvailable: true,
        blessAvailable: p.charKey === 'VICAIRE', curseAvailable: p.charKey === 'HERETIQUE'
      };
    });
    if (database) database.ref("games/" + gameId).update({ status: "playing", players: init, turnOrder: order, currentTurn: 0, targetPdv: order.length * 10 });
  };

  var copyCode = function() { 
    if (navigator.clipboard) navigator.clipboard.writeText(gameId);
    notify("Code copiÃ© !", "success"); 
  };

  return React.createElement("div", { className: "min-h-screen p-4" },
    React.createElement("div", { className: "max-w-2xl mx-auto" },
      // Code
      React.createElement("div", { className: "bg-white rounded-2xl shadow-lg p-6 mb-4" },
        React.createElement("h3", { className: "text-center text-gray-600 text-sm mb-2" }, "Code de la partie"),
        React.createElement("div", { className: "text-4xl font-bold text-center text-purple-600 tracking-widest cursor-pointer hover:text-purple-700 py-4 bg-purple-50 rounded-xl border-2 border-dashed border-purple-300", onClick: copyCode }, gameId),
        React.createElement("p", { className: "text-center text-gray-500 text-xs mt-2" }, "Cliquez pour copier")
      ),
      // Joueurs
      React.createElement("div", { className: "bg-white rounded-2xl shadow-lg p-6 mb-4" },
        React.createElement("h3", { className: "font-bold text-gray-800 mb-4" }, "Joueurs (" + players.length + "/6)"),
        players.map(function(p) {
          var isMe = p.oderId === user.uid;
          var ready = p.charKey && p.stats;
          return React.createElement("div", { key: p.oderId, className: "flex items-center gap-3 p-3 rounded-xl mb-2 " + (isMe ? 'bg-purple-50 border-2 border-purple-400' : 'bg-gray-50') + (ready ? ' border-green-400' : '') },
            React.createElement("div", { className: "w-12 h-12 rounded-full bg-gradient-to-r from-purple-600 to-blue-600 flex items-center justify-center text-2xl" }, p.charKey ? CHARACTERS[p.charKey].emoji : "ðŸ‘¤"),
            React.createElement("div", { className: "flex-1" },
              React.createElement("div", { className: "font-semibold text-gray-800 flex items-center gap-2" }, p.name,
                p.isHost && React.createElement("span", { className: "text-xs bg-yellow-400 text-yellow-900 px-2 py-0.5 rounded-full" }, "HÃ´te"),
                isMe && React.createElement("span", { className: "text-xs bg-purple-600 text-white px-2 py-0.5 rounded-full" }, "Vous")
              ),
              React.createElement("div", { className: "text-sm text-gray-600" }, p.charKey ? CHARACTERS[p.charKey].name : "Choisit...")
            ),
            ready && React.createElement("span", { className: "text-green-600 font-bold text-xl" }, "âœ“")
          );
        })
      ),
      // SÃ©lection personnage
      me && !me.charKey && React.createElement("div", { className: "bg-white rounded-2xl shadow-lg p-6 mb-4" },
        React.createElement("h3", { className: "font-bold text-gray-800 mb-4" }, "Choisissez votre personnage"),
        React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-3" },
          Object.values(CHARACTERS).map(function(ch) {
            var taken = takenChars.includes(ch.key);
            return React.createElement("div", { key: ch.key, onClick: function() { if (!taken) selectChar(ch.key); }, className: "p-4 rounded-xl border-2 cursor-pointer transition-all " + (taken ? 'opacity-40 cursor-not-allowed' : 'hover:border-purple-400 hover:bg-purple-50') },
              React.createElement("div", { className: "flex items-center gap-3" },
                React.createElement("span", { className: "text-3xl" }, ch.emoji),
                React.createElement("div", { className: "flex-1" },
                  React.createElement("div", { className: "font-bold" }, ch.name),
                  React.createElement("div", { className: "text-xs text-gray-600" }, ch.role),
                  React.createElement("div", { className: "text-sm text-purple-600 font-semibold" }, "â¤ï¸ " + ch.pvMax + " PV")
                ),
                taken && React.createElement("span", { className: "text-xs bg-red-500 text-white px-2 py-1 rounded" }, "PRIS")
              )
            );
          })
        )
      ),
      // Stats allocation
      me && me.charKey && !me.stats && React.createElement(StatsAlloc, { gameId: gameId, userId: user.uid, character: CHARACTERS[me.charKey], notify: notify }),
      // Bouton lancer
      isHost && React.createElement("button", { className: "w-full py-4 rounded-xl font-bold text-lg transition-all " + (allReady ? 'bg-gradient-to-r from-green-500 to-teal-500 text-white' : 'bg-gray-300 text-gray-500 cursor-not-allowed'), onClick: startGame, disabled: !allReady }, allReady ? "ðŸš€ Lancer la partie !" : "En attente (" + players.filter(function(p) { return p.charKey && p.stats; }).length + "/" + players.length + ")")
    )
  );
}

// Stats Allocation
function StatsAlloc(props) {
  var MODIFIERS = [-2, -1, 0, 0, 1, 2];
  var _state = useState({ endurance: null, force: null, vitesse: null, perception: null, sagesse: null, intelligence: null });
  var allocation = _state[0];
  var setAllocation = _state[1];

  var isModifierUsed = function(modifier) {
    var usedCount = Object.values(allocation).filter(function(v) { return v === modifier; }).length;
    var totalCount = MODIFIERS.filter(function(m) { return m === modifier; }).length;
    return usedCount >= totalCount;
  };

  var handleClick = function(stat, modifier) {
    if (allocation[stat] === modifier) {
      var newAlloc = Object.assign({}, allocation);
      newAlloc[stat] = null;
      setAllocation(newAlloc);
    } else if (!isModifierUsed(modifier) || allocation[stat] !== null) {
      var newAlloc2 = Object.assign({}, allocation);
      newAlloc2[stat] = modifier;
      setAllocation(newAlloc2);
    }
  };

  var isValid = Object.values(allocation).every(function(v) { return v !== null; });

  var confirmStats = function() {
    if (!isValid) return;
    if (database) database.ref("games/" + props.gameId + "/players/" + props.userId + "/stats").set(allocation);
    props.notify("Stats enregistrÃ©es !", "success");
  };

  return React.createElement("div", { className: "bg-white rounded-2xl shadow-lg p-6 mb-4" },
    React.createElement("h3", { className: "font-bold text-gray-800 mb-2" }, "RÃ©partissez vos stats"),
    React.createElement("p", { className: "text-gray-600 text-sm mb-4" }, "Assignez: -2, -1, 0, 0, +1, +2"),
    React.createElement("div", { className: "space-y-4" },
      Object.entries(STAT_NAMES).map(function(entry) {
        var key = entry[0];
        var name = entry[1];
        var val = allocation[key];
        return React.createElement("div", { key: key, className: "bg-gray-50 rounded-lg p-3" },
          React.createElement("div", { className: "flex justify-between items-center mb-2" },
            React.createElement("span", { className: "font-semibold text-gray-700" }, name),
            val !== null && React.createElement("span", { className: "font-bold " + (val > 0 ? 'text-green-600' : val < 0 ? 'text-red-600' : 'text-blue-600') }, val > 0 ? "+" + val : val)
          ),
          React.createElement("div", { className: "flex gap-2 justify-center" },
            MODIFIERS.map(function(mod, idx) {
              var isSelected = val === mod;
              var isDisabled = !isSelected && isModifierUsed(mod);
              var btnClass = "w-12 h-12 rounded-full font-bold text-sm transition-all ";
              if (isSelected) {
                btnClass += mod > 0 ? 'bg-green-600 text-white ring-4 ring-green-300' : mod < 0 ? 'bg-red-600 text-white ring-4 ring-red-300' : 'bg-blue-600 text-white ring-4 ring-blue-300';
              } else if (isDisabled) {
                btnClass += 'bg-gray-200 text-gray-400 cursor-not-allowed';
              } else {
                btnClass += 'bg-white border-2 border-gray-300 hover:border-purple-500';
              }
              return React.createElement("button", { key: idx, onClick: function() { handleClick(key, mod); }, disabled: isDisabled, className: btnClass }, mod > 0 ? "+" + mod : mod);
            })
          )
        );
      })
    ),
    React.createElement("button", { className: "w-full py-3 rounded-xl font-bold mt-4 " + (isValid ? 'bg-green-600 text-white hover:bg-green-700' : 'bg-gray-300 text-gray-500 cursor-not-allowed'), onClick: confirmStats, disabled: !isValid }, isValid ? "âœ“ Confirmer" : "ComplÃ©tez toutes les stats")
  );
}

// Game Screen
function GameScreen(props) {
  var gameId = props.gameId;
  var game = props.game;
  var user = props.user;
  var notify = props.notify;
  
  var _tab = useState('tirages');
  var activeTab = _tab[0];
  var setActiveTab = _tab[1];
  
  var _death = useState(false);
  var showDeath = _death[0];
  var setShowDeath = _death[1];
  
  var _start = useState(false);
  var showStart = _start[0];
  var setShowStart = _start[1];
  
  var _gains = useState({});
  var startGains = _gains[0];
  var setStartGains = _gains[1];

  if (!game || !game.players || !game.turnOrder) {
    return React.createElement("div", { className: "min-h-screen flex items-center justify-center" },
      React.createElement("div", { className: "w-12 h-12 border-4 border-purple-600 border-t-transparent rounded-full animate-spin" })
    );
  }

  var order = game.turnOrder;
  var curIdx = game.currentTurn || 0;
  var curUid = order[curIdx];
  var curPlayer = game.players[curUid];
  var me = game.players[user.uid];
  var isMyTurn = curUid === user.uid;
  var players = order.map(function(uid) { return game.players[uid]; }).filter(Boolean);
  var totalPdv = players.reduce(function(s, p) { return s + (p.pdv || 0); }, 0);
  var targetPdv = game.targetPdv || players.length * 10;

  var updateMe = function(updates) {
    if (database) return database.ref("games/" + gameId + "/players/" + user.uid).update(updates);
  };

  var updateGame = function(updates) {
    if (database) return database.ref("games/" + gameId).update(updates);
  };

  var addPdv = function(amount, source) {
    var newPdv = (me.pdv || 0) + amount;
    var newHistory = (me.pdvHistory || []).concat([{ id: Date.now(), amount: amount, source: source }]);
    return updateMe({ pdv: newPdv, pdvHistory: newHistory });
  };

  var nextTurn = function() {
    if (!isMyTurn) return;
    var next = (curIdx + 1) % order.length;
    updateMe({ usedAttackDice: false, rerollAvailable: true });
    updateGame({ currentTurn: next });
    notify("Tour passÃ© !", "success");
  };

  var handlePassStart = function() {
    var bonus = rulesEngine.getPassBonus(me);
    var tc = countTerritoriesByBiome(me.territories);
    setStartGains({ or: bonus.or || 0, cuivre: tc.FORET, argent: tc.DESERT, obsidienne: tc.MONTAGNE });
    setShowStart(true);
  };

  var confirmStart = function() {
    var bonus = rulesEngine.getPassBonus(me);
    var tc = countTerritoriesByBiome(me.territories);
    updateMe({
      or: (me.or || 0) + (bonus.or || 0),
      cuivre: (me.cuivre || 0) + tc.FORET,
      argent: (me.argent || 0) + tc.DESERT,
      obsidienne: (me.obsidienne || 0) + tc.MONTAGNE,
      blessAvailable: me.characterKey === 'VICAIRE',
      curseAvailable: me.characterKey === 'HERETIQUE'
    });
    addPdv(1, 'START');
    setShowStart(false);
  };

  useEffect(function() {
    if (me && me.pvCurrent <= 0 && !showDeath) setShowDeath(true);
  }, [me ? me.pvCurrent : 0]);

  var handleDeath = function() {
    updateMe({ pvCurrent: me.character.pvMax, effects: [] });
    setShowDeath(false);
  };

  // Death overlay
  if (showDeath) {
    return React.createElement("div", { className: "fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4" },
      React.createElement("div", { className: "bg-gradient-to-br from-red-800 to-gray-900 rounded-2xl p-8 max-w-md w-full text-white text-center" },
        React.createElement("div", { className: "text-6xl mb-4" }, "ðŸ’€"),
        React.createElement("h2", { className: "text-3xl font-bold mb-4" }, "MORT !"),
        React.createElement("p", { className: "mb-6" }, "PV restaurÃ©s, Ã©tats retirÃ©s"),
        React.createElement("button", { onClick: handleDeath, className: "px-8 py-3 bg-red-600 rounded-xl font-bold" }, "Ressusciter")
      )
    );
  }

  // Start overlay
  if (showStart) {
    return React.createElement("div", { className: "fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4" },
      React.createElement("div", { className: "bg-gradient-to-br from-teal-600 to-blue-700 rounded-2xl p-8 max-w-md w-full text-white text-center" },
        React.createElement("div", { className: "text-6xl mb-4" }, "ðŸ"),
        React.createElement("h2", { className: "text-3xl font-bold mb-4" }, "PASSAGE DÃ‰PART !"),
        React.createElement("div", { className: "bg-white bg-opacity-20 rounded-xl p-4 mb-6 space-y-2" },
          React.createElement("div", null, "ðŸ† +1 PDV"),
          startGains.or > 0 && React.createElement("div", null, "ðŸ’° +" + startGains.or + " Or"),
          startGains.cuivre > 0 && React.createElement("div", null, "ðŸŒ³ +" + startGains.cuivre + " Cuivre"),
          startGains.argent > 0 && React.createElement("div", null, "ðŸœï¸ +" + startGains.argent + " Argent"),
          startGains.obsidienne > 0 && React.createElement("div", null, "â›°ï¸ +" + startGains.obsidienne + " Obsidienne")
        ),
        React.createElement("button", { onClick: confirmStart, className: "px-8 py-3 bg-white text-teal-700 rounded-xl font-bold" }, "Continuer")
      )
    );
  }

  var tabs = [
    { id: "tirages", label: "Tirages" },
    { id: "de", label: "DÃ©" },
    { id: "attaque", label: "Attaque" },
    { id: "objectif", label: "Objectif" },
    { id: "echange", label: "Ã‰change" },
    { id: "personnage", label: "Perso" },
    { id: "pdv", label: "PDV" }
  ];

  return React.createElement("div", { className: "min-h-screen bg-gradient-to-br from-purple-100 to-blue-100 flex flex-col pb-24" },
    // Header
    React.createElement("div", { className: "p-4 text-white " + (isMyTurn ? 'bg-gradient-to-r from-green-600 to-teal-600' : 'bg-gradient-to-r from-orange-500 to-red-500') },
      React.createElement("div", { className: "max-w-4xl mx-auto" },
        React.createElement("div", { className: "text-sm font-bold mb-1" }, isMyTurn ? "ðŸŽ¯ C'EST VOTRE TOUR !" : "â³ Tour de " + (curPlayer ? curPlayer.name : '?')),
        React.createElement("div", { className: "flex justify-between items-center" },
          React.createElement("div", null,
            React.createElement("div", { className: "text-xl font-bold" }, me ? me.name : ''),
            React.createElement("div", { className: "text-sm opacity-90" }, me && me.character ? me.character.name : '')
          ),
          React.createElement("div", { className: "text-right" },
            React.createElement("div", { className: "text-2xl font-bold" }, (me ? me.pvCurrent : 0) + "/" + (me && me.character ? me.character.pvMax : 0)),
            React.createElement("div", { className: "text-xs" }, "PV")
          )
        ),
        React.createElement("div", { className: "flex gap-2 mt-2 text-xs flex-wrap" },
          React.createElement("span", { className: "bg-white bg-opacity-20 px-2 py-1 rounded" }, "ðŸ’° " + (me ? me.or || 0 : 0)),
          React.createElement("span", { className: "bg-white bg-opacity-20 px-2 py-1 rounded" }, "ðŸŒ³ " + (me ? me.cuivre || 0 : 0)),
          React.createElement("span", { className: "bg-white bg-opacity-20 px-2 py-1 rounded" }, "ðŸœï¸ " + (me ? me.argent || 0 : 0)),
          React.createElement("span", { className: "bg-white bg-opacity-20 px-2 py-1 rounded" }, "â›°ï¸ " + (me ? me.obsidienne || 0 : 0)),
          React.createElement("span", { className: "bg-yellow-400 text-yellow-900 px-2 py-1 rounded font-bold" }, "ðŸ† " + (me ? me.pdv || 0 : 0))
        )
      )
    ),
    // Progress bar
    React.createElement("div", { className: "bg-white shadow px-4 py-2" },
      React.createElement("div", { className: "max-w-4xl mx-auto" },
        React.createElement("div", { className: "flex justify-between text-xs text-gray-600 mb-1" },
          React.createElement("span", null, "Progression"),
          React.createElement("span", null, totalPdv + " / " + targetPdv + " PDV")
        ),
        React.createElement("div", { className: "h-2 bg-gray-200 rounded-full overflow-hidden" },
          React.createElement("div", { className: "h-full bg-gradient-to-r from-purple-600 to-blue-600 rounded-full", style: { width: Math.min(100, (totalPdv / targetPdv) * 100) + "%" } })
        )
      )
    ),
    // Tabs
    React.createElement("div", { className: "bg-white shadow-md overflow-x-auto" },
      React.createElement("div", { className: "flex max-w-4xl mx-auto" },
        tabs.map(function(t) {
          return React.createElement("button", { key: t.id, onClick: function() { setActiveTab(t.id); }, className: "flex-shrink-0 px-4 py-3 font-semibold text-sm border-b-4 " + (activeTab === t.id ? 'bg-purple-600 text-white border-purple-800' : 'bg-gray-100 text-gray-600 border-transparent hover:bg-gray-200') }, t.label);
        })
      )
    ),
    // Content
    React.createElement("div", { className: "flex-1 overflow-y-auto p-4" },
      React.createElement("div", { className: "max-w-4xl mx-auto" },
        React.createElement("div", { className: "bg-white rounded-2xl shadow-lg p-6" },
          activeTab === 'tirages' && React.createElement(TiragesTab, { me: me, isMyTurn: isMyTurn, updateMe: updateMe, notify: notify, game: game, updateGame: updateGame, addPdv: addPdv }),
          activeTab === 'de' && React.createElement(DeTab, { me: me, isMyTurn: isMyTurn, updateMe: updateMe, notify: notify }),
          activeTab === 'attaque' && React.createElement(AttaqueTab, { me: me, isMyTurn: isMyTurn, updateMe: updateMe, notify: notify, game: game, addPdv: addPdv, players: players }),
          activeTab === 'objectif' && React.createElement(ObjectifTab, { me: me, isMyTurn: isMyTurn, updateMe: updateMe, notify: notify, game: game, updateGame: updateGame, addPdv: addPdv }),
          activeTab === 'echange' && React.createElement(EchangeTab, { me: me, isMyTurn: isMyTurn, updateMe: updateMe, notify: notify, game: game, gameId: gameId, players: players }),
          activeTab === 'personnage' && React.createElement(PersonnageTab, { me: me, updateMe: updateMe, handlePassStart: handlePassStart, isMyTurn: isMyTurn }),
          activeTab === 'pdv' && React.createElement(PdvTab, { me: me, players: players })
        )
      )
    ),
    // End turn button
    isMyTurn && React.createElement("div", { className: "fixed bottom-0 left-0 right-0 p-4 bg-white shadow-lg border-t" },
      React.createElement("div", { className: "max-w-4xl mx-auto" },
        React.createElement("button", { className: "w-full py-4 bg-gradient-to-r from-green-500 to-teal-500 text-white rounded-xl font-bold text-lg", onClick: nextTurn }, "âœ… Fin de mon tour")
      )
    )
  );
}

// Tirages Tab
function TiragesTab(props) {
  var me = props.me;
  var isMyTurn = props.isMyTurn;
  var updateMe = props.updateMe;
  var notify = props.notify;
  var game = props.game;
  var updateGame = props.updateGame;
  
  var _anom = useState(null);
  var anomCard = _anom[0];
  var setAnomCard = _anom[1];
  
  var _quest = useState(null);
  var questCard = _quest[0];
  var setQuestCard = _quest[1];
  
  var _applied = useState(null);
  var applied = _applied[0];
  var setApplied = _applied[1];

  var drawAnomaly = function() {
    if (!isMyTurn) return notify("Pas votre tour", "error");
    var drawn = game.drawnAnomalies || [];
    var available = ANOMALIES.filter(function(_, i) { return !drawn.includes(i); });
    if (available.length === 0) return notify("Deck vide !", "error");
    
    var idx = Math.floor(Math.random() * available.length);
    var card = available[idx];
    var origIdx = ANOMALIES.indexOf(card);
    
    updateGame({ drawnAnomalies: drawn.concat([origIdx]) });
    setAnomCard(card);
    
    var effect = parseAnomaly(card);
    var msg = "";
    
    if (effect.type === 'heal') {
      updateMe({ pvCurrent: Math.min(me.character.pvMax, me.pvCurrent + effect.amount) });
      msg = "+" + effect.amount + " PV";
    } else if (effect.type === 'damage') {
      updateMe({ pvCurrent: Math.max(0, me.pvCurrent - effect.amount) });
      msg = "-" + effect.amount + " PV";
    } else if (effect.type === 'bless') {
      var newEffects = (me.effects || []).concat([{ id: Date.now(), type: 'BLESS', stat: effect.stat, delta: 2, name: "BÃ©nÃ©diction " + STAT_NAMES[effect.stat] }]);
      updateMe({ effects: newEffects });
      msg = "BÃ©nÃ©diction " + STAT_NAMES[effect.stat] + " (+2)";
    } else if (effect.type === 'curse') {
      var newEffects2 = (me.effects || []).concat([{ id: Date.now(), type: 'CURSE', stat: effect.stat, delta: -2, name: "MalÃ©diction " + STAT_NAMES[effect.stat] }]);
      updateMe({ effects: newEffects2 });
      msg = "MalÃ©diction " + STAT_NAMES[effect.stat] + " (-2)";
    } else if (effect.type === 'gain') {
      var upd = {};
      upd[effect.resource] = (me[effect.resource] || 0) + effect.amount;
      updateMe(upd);
      msg = "+" + effect.amount + " " + effect.resource;
    } else if (effect.type === 'lose') {
      var upd2 = {};
      upd2[effect.resource] = Math.max(0, (me[effect.resource] || 0) - effect.amount);
      updateMe(upd2);
      msg = "-" + effect.amount + " " + effect.resource;
    } else if (effect.type === 'recharge') {
      updateMe({ blessAvailable: me.characterKey === 'VICAIRE', curseAvailable: me.characterKey === 'HERETIQUE' });
      msg = "Pouvoirs rechargÃ©s !";
    }
    setApplied(msg);
  };

  var drawQuest = function() {
    if (!isMyTurn) return notify("Pas votre tour", "error");
    if ((me.quests || []).length >= 2) return notify("Max 2 quÃªtes !", "error");
    var drawn = game.drawnQuetes || [];
    var available = QUETES.filter(function(_, i) { return !drawn.includes(i); });
    if (available.length === 0) return notify("Deck vide !", "error");
    
    var idx = Math.floor(Math.random() * available.length);
    var card = available[idx];
    var origIdx = QUETES.indexOf(card);
    
    updateGame({ drawnQuetes: drawn.concat([origIdx]) });
    setQuestCard(card);
    
    var newQuests = (me.quests || []).concat([{ id: Date.now(), text: card }]);
    updateMe({ quests: newQuests });
  };

  var drawnAnomaliesCount = (game.drawnAnomalies || []).length;
  var drawnQuetesCount = (game.drawnQuetes || []).length;

  return React.createElement("div", { className: "space-y-6" },
    React.createElement("h3", { className: "text-2xl font-bold text-center text-gray-800" }, "ðŸŽ´ Tirages"),
    // Anomalie
    React.createElement("div", null,
      React.createElement("h4", { className: "font-bold text-gray-700 mb-2" }, "Anomalie (" + (ANOMALIES.length - drawnAnomaliesCount) + " restantes)"),
      React.createElement("div", { className: "min-h-32 bg-gradient-to-r from-purple-600 to-purple-800 rounded-xl p-6 flex items-center justify-center text-white mb-3" },
        anomCard ? React.createElement("div", { className: "text-center" },
          React.createElement("p", { className: "font-medium" }, anomCard),
          applied && React.createElement("p", { className: "text-yellow-300 font-bold mt-2" }, "âœ¨ " + applied)
        ) : React.createElement("p", { className: "text-purple-200 italic" }, "Tirez une carte...")
      ),
      React.createElement("button", { onClick: drawAnomaly, disabled: !isMyTurn, className: "w-full py-3 bg-purple-600 text-white rounded-xl font-semibold hover:bg-purple-700 disabled:opacity-50" }, "ðŸ”® Tirer Anomalie")
    ),
    // QuÃªte
    React.createElement("div", null,
      React.createElement("h4", { className: "font-bold text-gray-700 mb-2" }, "QuÃªte (" + (me.quests || []).length + "/2 | " + (QUETES.length - drawnQuetesCount) + " restantes)"),
      React.createElement("div", { className: "min-h-32 bg-gradient-to-r from-green-600 to-green-800 rounded-xl p-6 flex items-center justify-center text-white mb-3" },
        questCard ? React.createElement("p", { className: "font-medium text-center" }, questCard) : React.createElement("p", { className: "text-green-200 italic" }, "Tirez une quÃªte...")
      ),
      React.createElement("button", { onClick: drawQuest, disabled: !isMyTurn || (me.quests || []).length >= 2, className: "w-full py-3 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 disabled:opacity-50" }, (me.quests || []).length >= 2 ? "Maximum atteint" : "ðŸ“œ Tirer QuÃªte")
    ),
    // QuÃªtes actives
    (me.quests || []).length > 0 && React.createElement("div", null,
      React.createElement("h4", { className: "font-bold text-gray-700 mb-2" }, "Mes quÃªtes"),
      React.createElement("div", { className: "space-y-2" },
        (me.quests || []).map(function(q) { return React.createElement("div", { key: q.id, className: "bg-gray-50 rounded-lg p-3 text-sm" }, q.text); })
      )
    )
  );
}

// De Tab
function DeTab(props) {
  var me = props.me;
  var isMyTurn = props.isMyTurn;
  var updateMe = props.updateMe;
  var notify = props.notify;
  
  var _move = useState(null);
  var moveResult = _move[0];
  var setMoveResult = _move[1];
  
  var _attack = useState(null);
  var attackResult = _attack[0];
  var setAttackResult = _attack[1];
  
  var _rolling = useState(false);
  var rolling = _rolling[0];
  var setRolling = _rolling[1];
  
  var _reroll = useState(false);
  var showReroll = _reroll[0];
  var setShowReroll = _reroll[1];

  var rollMove = function() {
    if (!isMyTurn) return notify("Pas votre tour", "error");
    setRolling(true);
    setTimeout(function() {
      setMoveResult(Math.floor(Math.random() * 10) + 1);
      setRolling(false);
    }, 500);
  };

  var rollAttack = function() {
    if (!isMyTurn) return notify("Pas votre tour", "error");
    if (me.usedAttackDice) return notify("DÃ©jÃ  utilisÃ© ce tour", "error");
    setRolling(true);
    
    setTimeout(function() {
      var statIdx = Math.floor(Math.random() * STATISTIQUES.length);
      var stat = STATISTIQUES[statIdx];
      var statKey = STAT_MAPPING[stat] || stat.toLowerCase();
      var dice = Math.floor(Math.random() * 10) + 1;
      var base = me.stats ? (me.stats[statKey] || 0) : 0;
      var effects = (me.effects || []).filter(function(e) { return e.stat === statKey; }).reduce(function(s, e) { return s + e.delta; }, 0);
      var total = dice + base + effects;
      var result = { stat: stat, statKey: statKey, dice: dice, base: base, effects: effects, total: total, crit: dice === 10 };
      setAttackResult(result);
      
      if (me.characterKey === 'VICAIRE' && me.rerollAvailable) {
        setShowReroll(true);
      } else {
        updateMe({ usedAttackDice: true });
      }
      setRolling(false);
    }, 500);
  };

  var handleReroll = function(accept) {
    if (accept) {
      var resource = getRandomAvailableResource(me);
      if (!resource) {
        notify("Pas de ressource !", "error");
        updateMe({ usedAttackDice: true });
        setShowReroll(false);
        return;
      }
      var stats = STATISTIQUES.filter(function(s) { return (STAT_MAPPING[s] || s.toLowerCase()) !== attackResult.statKey; });
      var newStat = stats[Math.floor(Math.random() * stats.length)];
      var newKey = STAT_MAPPING[newStat] || newStat.toLowerCase();
      var base = me.stats ? (me.stats[newKey] || 0) : 0;
      var effects = (me.effects || []).filter(function(e) { return e.stat === newKey; }).reduce(function(s, e) { return s + e.delta; }, 0);
      var total = attackResult.dice + base + effects;
      setAttackResult({ stat: newStat, statKey: newKey, dice: attackResult.dice, base: base, effects: effects, total: total, crit: attackResult.crit, rerolled: true });
      var upd = { usedAttackDice: true, rerollAvailable: false };
      upd[resource] = Math.max(0, (me[resource] || 0) - 1);
      updateMe(upd);
      notify("Relance ! -1 " + resource, "success");
    } else {
      updateMe({ usedAttackDice: true });
    }
    setShowReroll(false);
  };

  // Reroll popup
  if (showReroll) {
    return React.createElement("div", { className: "space-y-6" },
      React.createElement("h3", { className: "text-xl font-bold text-center" }, "ðŸ”„ Relance Vicaire"),
      React.createElement("p", { className: "text-center text-gray-600" }, "Changer la statistique ? (coÃ»t: 1 ressource)"),
      React.createElement("div", { className: "bg-purple-100 rounded-xl p-4 text-center" },
        React.createElement("div", { className: "text-lg font-bold text-purple-600" }, attackResult ? attackResult.stat : ''),
        React.createElement("div", { className: "text-4xl font-bold" }, attackResult ? attackResult.total : 0)
      ),
      React.createElement("div", { className: "flex gap-3" },
        React.createElement("button", { onClick: function() { handleReroll(true); }, className: "flex-1 py-3 bg-green-600 text-white rounded-xl font-bold" }, "âœ… Oui"),
        React.createElement("button", { onClick: function() { handleReroll(false); }, className: "flex-1 py-3 bg-gray-400 text-white rounded-xl font-bold" }, "âŒ Non")
      )
    );
  }

  return React.createElement("div", { className: "space-y-6" },
    React.createElement("h3", { className: "text-2xl font-bold text-center text-gray-800" }, "ðŸŽ² DÃ©s"),
    // Move
    React.createElement("div", { className: "bg-gray-50 rounded-xl p-4" },
      React.createElement("h4", { className: "font-bold text-gray-700 mb-3" }, "DÃ©placement"),
      React.createElement("div", { className: "min-h-32 bg-gradient-to-r from-blue-600 to-blue-800 rounded-xl p-6 flex flex-col items-center justify-center text-white mb-3 " + (rolling ? 'animate-pulse' : '') },
        moveResult !== null ? React.createElement(React.Fragment, null,
          React.createElement("div", { className: "text-6xl font-bold" }, moveResult),
          moveResult === 10 && React.createElement("div", { className: "text-yellow-300 font-bold mt-2" }, "âœ¨ Critique !")
        ) : React.createElement("p", { className: "text-blue-200" }, "Lancez le dÃ©")
      ),
      React.createElement("button", { onClick: rollMove, disabled: !isMyTurn || rolling, className: "w-full py-3 bg-blue-600 text-white rounded-xl font-semibold disabled:opacity-50" }, "ðŸŽ² Lancer (1-10)")
    ),
    // Attack
    React.createElement("div", { className: "bg-gray-50 rounded-xl p-4" },
      React.createElement("h4", { className: "font-bold text-gray-700 mb-3" }, "Attaque"),
      me.usedAttackDice && React.createElement("div", { className: "bg-yellow-100 border border-yellow-400 rounded-lg p-2 mb-3 text-center text-sm text-yellow-800" }, "âš ï¸ DÃ©jÃ  utilisÃ©"),
      React.createElement("div", { className: "min-h-40 bg-gradient-to-r from-red-600 to-red-800 rounded-xl p-6 flex flex-col items-center justify-center text-white mb-3 " + (rolling ? 'animate-pulse' : '') },
        attackResult ? React.createElement("div", { className: "text-center w-full" },
          React.createElement("div", { className: "text-yellow-300 font-bold text-xl mb-2" }, attackResult.stat + (attackResult.rerolled ? " ðŸ”„" : "")),
          React.createElement("div", { className: "text-5xl font-bold mb-3" }, attackResult.total),
          attackResult.crit && React.createElement("div", { className: "text-yellow-300 font-bold" }, "âœ¨ Critique !"),
          React.createElement("div", { className: "bg-white bg-opacity-20 rounded-lg p-3 mt-2 text-sm" },
            React.createElement("div", { className: "flex justify-between" }, React.createElement("span", null, "DÃ©:"), React.createElement("span", { className: "font-bold" }, attackResult.dice)),
            React.createElement("div", { className: "flex justify-between" }, React.createElement("span", null, "Base:"), React.createElement("span", { className: "font-bold" }, attackResult.base >= 0 ? "+" + attackResult.base : attackResult.base)),
            React.createElement("div", { className: "flex justify-between" }, React.createElement("span", null, "Ã‰tats:"), React.createElement("span", { className: "font-bold " + (attackResult.effects >= 0 ? 'text-green-300' : 'text-red-300') }, attackResult.effects >= 0 ? "+" + attackResult.effects : attackResult.effects))
          )
        ) : React.createElement("p", { className: "text-red-200" }, "Lancez le dÃ©")
      ),
      React.createElement("button", { onClick: rollAttack, disabled: !isMyTurn || rolling || me.usedAttackDice, className: "w-full py-3 bg-red-600 text-white rounded-xl font-semibold disabled:opacity-50" }, "âš”ï¸ Lancer Attaque")
    )
  );
}

// Attaque Tab (simplifiÃ©)
function AttaqueTab(props) {
  var me = props.me;
  var isMyTurn = props.isMyTurn;
  var updateMe = props.updateMe;
  var notify = props.notify;
  var addPdv = props.addPdv;

  var _biome = useState(null);
  var selectedBiome = _biome[0];
  var setSelectedBiome = _biome[1];
  
  var _diff = useState(null);
  var selectedDiff = _diff[0];
  var setSelectedDiff = _diff[1];
  
  var _result = useState(null);
  var result = _result[0];
  var setResult = _result[1];

  var attackTerritory = function() {
    if (!isMyTurn) return notify("Pas votre tour", "error");
    if (me.usedAttackDice) return notify("DÃ© dÃ©jÃ  utilisÃ©", "error");
    if (!selectedBiome || !selectedDiff) return notify("SÃ©lectionnez biome et difficultÃ©", "error");
    
    var statKeys = Object.keys(STAT_NAMES);
    var statKey = statKeys[Math.floor(Math.random() * statKeys.length)];
    var dice = Math.floor(Math.random() * 10) + 1;
    var base = me.stats ? (me.stats[statKey] || 0) : 0;
    var effects = (me.effects || []).filter(function(e) { return e.stat === statKey; }).reduce(function(s, e) { return s + e.delta; }, 0);
    var bonus = rulesEngine.getAttackBonus(me, { type: 'TERRITORY', isNeutral: true });
    var total = dice + base + effects + bonus.bonus;
    var success = total >= selectedDiff;
    var pdv = selectedDiff === 6 ? 3 : selectedDiff === 8 ? 4 : 5;
    var resource = BIOMES[selectedBiome].resource;
    
    if (success) {
      var newTerritories = (me.territories || []).concat([{ biome: selectedBiome, difficulty: selectedDiff }]);
      var upd = { territories: newTerritories, usedAttackDice: true };
      upd[resource] = (me[resource] || 0) + 1;
      var heal = rulesEngine.getHealOnSuccess(me);
      if (heal > 0) upd.pvCurrent = Math.min(me.character.pvMax, me.pvCurrent + heal);
      updateMe(upd);
      addPdv(pdv, 'TERRITORY');
    } else {
      var damage = Math.max(1, selectedDiff - total);
      updateMe({ pvCurrent: Math.max(0, me.pvCurrent - damage), usedAttackDice: true });
    }
    
    setResult({ stat: STAT_NAMES[statKey], dice: dice, base: base, effects: effects, bonus: bonus.bonus, total: total, difficulty: selectedDiff, success: success, pdv: pdv, biome: selectedBiome });
  };

  if (result) {
    return React.createElement("div", { className: "space-y-4" },
      React.createElement("div", { className: "rounded-xl p-6 text-white text-center " + (result.success ? 'bg-gradient-to-r from-green-500 to-teal-500' : 'bg-gradient-to-r from-red-500 to-orange-500') },
        React.createElement("div", { className: "text-4xl font-bold mb-2" }, result.success ? "âœ… VICTOIRE !" : "âŒ Ã‰CHEC"),
        React.createElement("div", { className: "text-xl mb-2" }, BIOMES[result.biome].emoji + " Diff." + result.difficulty),
        React.createElement("div", { className: "text-lg mb-4" }, result.total + " vs " + result.difficulty),
        result.success && React.createElement("div", { className: "text-lg" }, "+" + result.pdv + " PDV !")
      ),
      React.createElement("button", { onClick: function() { setResult(null); setSelectedBiome(null); setSelectedDiff(null); }, className: "w-full py-3 bg-gray-600 text-white rounded-xl font-semibold" }, "Fermer")
    );
  }

  return React.createElement("div", { className: "space-y-6" },
    React.createElement("h3", { className: "text-2xl font-bold text-center text-gray-800" }, "âš”ï¸ Attaque"),
    me.usedAttackDice && React.createElement("div", { className: "bg-yellow-100 border border-yellow-400 rounded-lg p-3 text-center text-yellow-800" }, "âš ï¸ DÃ© d'attaque dÃ©jÃ  utilisÃ©"),
    // Biome selection
    React.createElement("div", { className: "bg-gray-50 rounded-xl p-4" },
      React.createElement("h4", { className: "font-bold text-gray-700 mb-3" }, "ðŸ° ConquÃ©rir territoire"),
      React.createElement("div", { className: "mb-3" },
        React.createElement("label", { className: "text-sm text-gray-600 mb-2 block" }, "Biome"),
        React.createElement("div", { className: "grid grid-cols-3 gap-2" },
          Object.entries(BIOMES).map(function(entry) {
            var k = entry[0];
            var b = entry[1];
            return React.createElement("button", { key: k, onClick: function() { setSelectedBiome(k); }, className: "p-3 rounded-lg text-center " + (selectedBiome === k ? 'bg-purple-600 text-white' : 'bg-white border-2 border-gray-200') },
              React.createElement("div", { className: "text-2xl" }, b.emoji),
              React.createElement("div", { className: "text-xs mt-1" }, b.name.split(' ')[0])
            );
          })
        )
      ),
      React.createElement("div", { className: "mb-3" },
        React.createElement("label", { className: "text-sm text-gray-600 mb-2 block" }, "DifficultÃ©"),
        React.createElement("div", { className: "grid grid-cols-3 gap-2" },
          [6, 8, 10].map(function(d) {
            return React.createElement("button", { key: d, onClick: function() { setSelectedDiff(d); }, className: "p-3 rounded-lg text-center " + (selectedDiff === d ? 'bg-purple-600 text-white' : 'bg-white border-2 border-gray-200') },
              React.createElement("div", { className: "font-bold" }, d),
              React.createElement("div", { className: "text-xs" }, (d === 6 ? 3 : d === 8 ? 4 : 5) + " PDV")
            );
          })
        )
      ),
      React.createElement("button", { onClick: attackTerritory, disabled: !isMyTurn || me.usedAttackDice || !selectedBiome || !selectedDiff, className: "w-full py-3 bg-purple-600 text-white rounded-xl font-semibold disabled:opacity-50" }, "âš”ï¸ Attaquer")
    ),
    // Territoires
    (me.territories || []).length > 0 && React.createElement("div", { className: "bg-green-50 rounded-xl p-4" },
      React.createElement("h4", { className: "font-bold text-gray-700 mb-2" }, "ðŸ° Mes territoires (" + (me.territories || []).length + ")"),
      React.createElement("div", { className: "flex flex-wrap gap-2" },
        (me.territories || []).map(function(t, i) { return React.createElement("span", { key: i, className: "bg-green-200 text-green-800 px-3 py-1 rounded-full text-sm" }, BIOMES[t.biome].emoji + " Diff." + t.difficulty); })
      )
    )
  );
}

// Objectif Tab (simplifiÃ©)
function ObjectifTab(props) {
  var me = props.me;
  var isMyTurn = props.isMyTurn;
  var updateMe = props.updateMe;
  var notify = props.notify;
  var game = props.game;
  var updateGame = props.updateGame;
  var addPdv = props.addPdv;

  var completeObjective = function(obj) {
    if (!isMyTurn) return notify("Pas votre tour", "error");
    var completed = game.completedObjectives || [];
    if (completed.includes(obj.id)) return notify("DÃ©jÃ  complÃ©tÃ©", "error");
    if ((me[obj.resource] || 0) < obj.amount) return notify("Ressources insuffisantes", "error");
    
    var upd = {};
    upd[obj.resource] = me[obj.resource] - obj.amount;
    updateMe(upd);
    updateGame({ completedObjectives: completed.concat([obj.id]) });
    addPdv(obj.pdv, 'BONUS');
    notify("+" + obj.pdv + " PDV !", "success");
  };

  var exchangeQuest = function(quest) {
    if (!isMyTurn) return notify("Pas votre tour", "error");
    var info = parseQuest(quest.text);
    if (!info.isExchange) return;
    if ((me[info.resourceKey] || 0) < info.resourceAmount) return notify("Ressources insuffisantes", "error");
    
    var questBonus = rulesEngine.getQuestBonus(me);
    var newQuests = (me.quests || []).filter(function(q) { return q.id !== quest.id; });
    var upd = { quests: newQuests };
    upd[info.resourceKey] = me[info.resourceKey] - info.resourceAmount;
    updateMe(upd);
    addPdv(info.pdv + questBonus, 'QUEST_EXCHANGE');
    notify("+" + (info.pdv + questBonus) + " PDV !", "success");
  };

  var completedObjectives = game.completedObjectives || [];

  return React.createElement("div", { className: "space-y-6" },
    React.createElement("h3", { className: "text-2xl font-bold text-center text-gray-800" }, "ðŸŽ¯ Objectifs"),
    // Objectifs
    React.createElement("div", { className: "bg-purple-50 rounded-xl p-4" },
      React.createElement("h4", { className: "font-bold text-gray-700 mb-3" }, "Objectifs de ressources"),
      React.createElement("div", { className: "space-y-2" },
        OBJECTIVES.map(function(obj) {
          var completed = completedObjectives.includes(obj.id);
          var canComplete = (me[obj.resource] || 0) >= obj.amount && !completed;
          return React.createElement("div", { key: obj.id, className: "p-3 rounded-lg flex items-center justify-between " + (completed ? 'bg-green-100' : canComplete ? 'bg-blue-50' : 'bg-white') },
            React.createElement("div", { className: "flex items-center gap-2" },
              React.createElement("span", { className: "text-xl" }, obj.emoji),
              React.createElement("span", { className: "font-semibold" }, obj.label),
              React.createElement("span", { className: "text-sm text-gray-500" }, "(vous: " + (me[obj.resource] || 0) + ")")
            ),
            completed ? React.createElement("span", { className: "text-green-600 font-bold" }, "âœ“") :
            React.createElement("button", { onClick: function() { completeObjective(obj); }, disabled: !isMyTurn || !canComplete, className: "px-3 py-1 rounded font-semibold " + (canComplete ? 'bg-blue-600 text-white' : 'bg-gray-300 text-gray-500') }, "+" + obj.pdv)
          );
        })
      )
    ),
    // QuÃªtes
    React.createElement("div", { className: "bg-green-50 rounded-xl p-4" },
      React.createElement("h4", { className: "font-bold text-gray-700 mb-3" }, "Mes quÃªtes (" + (me.quests || []).length + "/2)"),
      (me.quests || []).length === 0 ? React.createElement("p", { className: "text-gray-500 italic text-center py-4" }, "Aucune quÃªte") :
      React.createElement("div", { className: "space-y-3" },
        (me.quests || []).map(function(q) {
          var info = parseQuest(q.text);
          var canExchange = info.isExchange && (me[info.resourceKey] || 0) >= info.resourceAmount;
          return React.createElement("div", { key: q.id, className: "bg-white rounded-lg p-4" },
            React.createElement("p", { className: "text-sm text-gray-700 mb-3" }, q.text),
            info.isExchange && React.createElement("button", { onClick: function() { exchangeQuest(q); }, disabled: !isMyTurn || !canExchange, className: "w-full py-2 rounded-lg font-semibold " + (canExchange ? 'bg-green-600 text-white' : 'bg-gray-300 text-gray-500') }, canExchange ? "âœ… Ã‰changer (+" + info.pdv + " PDV)" : "Ressources insuffisantes")
          );
        })
      )
    )
  );
}

// Ã‰change Tab (simplifiÃ©)
function EchangeTab(props) {
  var me = props.me;
  var isMyTurn = props.isMyTurn;
  var updateMe = props.updateMe;
  var notify = props.notify;

  var convertResource = function(from) {
    if (!isMyTurn) return notify("Pas votre tour", "error");
    var rate = EXCHANGE_RATES[from];
    if (!rate || (me[from] || 0) < 1) return notify("Pas assez", "error");
    var upd = { or: (me.or || 0) + rate.toOr };
    upd[from] = me[from] - 1;
    updateMe(upd);
    notify("+" + rate.toOr + " Or", "success");
  };

  return React.createElement("div", { className: "space-y-6" },
    React.createElement("h3", { className: "text-2xl font-bold text-center text-gray-800" }, "ðŸ”„ Ã‰change"),
    React.createElement("div", { className: "bg-yellow-50 rounded-xl p-4" },
      React.createElement("h4", { className: "font-bold text-gray-700 mb-3" }, "ðŸ’± Conversion en Or"),
      React.createElement("div", { className: "grid grid-cols-3 gap-2" },
        ['cuivre', 'argent', 'obsidienne'].map(function(res) {
          var rate = EXCHANGE_RATES[res];
          var emoji = res === 'cuivre' ? 'ðŸŒ³' : res === 'argent' ? 'ðŸœï¸' : 'â›°ï¸';
          var has = (me[res] || 0) >= 1;
          return React.createElement("button", { key: res, onClick: function() { convertResource(res); }, disabled: !isMyTurn || !has, className: "p-3 rounded-lg text-center " + (has ? 'bg-white hover:bg-yellow-100' : 'bg-gray-100 opacity-50') },
            React.createElement("div", { className: "text-2xl" }, emoji),
            React.createElement("div", { className: "text-xs mt-1" }, "1 â†’ " + rate.toOr + " ðŸ’°"),
            React.createElement("div", { className: "text-xs text-gray-500" }, "(" + (me[res] || 0) + ")")
          );
        })
      )
    ),
    React.createElement("div", { className: "bg-gray-50 rounded-xl p-4" },
      React.createElement("h4", { className: "font-bold text-gray-700 mb-3" }, "Mes ressources"),
      React.createElement("div", { className: "grid grid-cols-4 gap-3 text-center" },
        React.createElement("div", { className: "bg-white rounded-lg p-3" }, React.createElement("div", { className: "text-2xl" }, "ðŸ’°"), React.createElement("div", { className: "font-bold text-xl" }, me.or || 0)),
        React.createElement("div", { className: "bg-white rounded-lg p-3" }, React.createElement("div", { className: "text-2xl" }, "ðŸŒ³"), React.createElement("div", { className: "font-bold text-xl" }, me.cuivre || 0)),
        React.createElement("div", { className: "bg-white rounded-lg p-3" }, React.createElement("div", { className: "text-2xl" }, "ðŸœï¸"), React.createElement("div", { className: "font-bold text-xl" }, me.argent || 0)),
        React.createElement("div", { className: "bg-white rounded-lg p-3" }, React.createElement("div", { className: "text-2xl" }, "â›°ï¸"), React.createElement("div", { className: "font-bold text-xl" }, me.obsidienne || 0))
      )
    )
  );
}

// Personnage Tab (simplifiÃ©)
function PersonnageTab(props) {
  var me = props.me;
  var updateMe = props.updateMe;
  var handlePassStart = props.handlePassStart;
  var isMyTurn = props.isMyTurn;

  var adjustPv = function(delta) {
    updateMe({ pvCurrent: Math.max(0, Math.min(me.character.pvMax, me.pvCurrent + delta)) });
  };

  var adjustResource = function(key, delta) {
    var upd = {};
    upd[key] = Math.max(0, (me[key] || 0) + delta);
    updateMe(upd);
  };

  return React.createElement("div", { className: "space-y-6" },
    React.createElement("div", { className: "text-center" },
      React.createElement("div", { className: "text-5xl mb-2" }, me.character ? me.character.emoji : ''),
      React.createElement("h3", { className: "text-2xl font-bold text-gray-800" }, me.character ? me.character.name : ''),
      React.createElement("p", { className: "text-gray-600" }, me.character ? me.character.role : '')
    ),
    isMyTurn && React.createElement("button", { onClick: handlePassStart, className: "w-full py-3 bg-gradient-to-r from-teal-500 to-blue-500 text-white rounded-xl font-bold" }, "ðŸ Passage par DÃ©part (+1 PDV)"),
    // PV
    React.createElement("div", { className: "bg-red-50 rounded-xl p-4" },
      React.createElement("h4", { className: "font-bold text-gray-700 mb-2" }, "â¤ï¸ Points de Vie"),
      React.createElement("div", { className: "text-center text-3xl font-bold text-red-600 mb-3" }, me.pvCurrent + " / " + (me.character ? me.character.pvMax : 0)),
      React.createElement("div", { className: "flex gap-2 justify-center" },
        React.createElement("button", { onClick: function() { adjustPv(-1); }, className: "px-4 py-2 bg-red-200 rounded-lg font-bold" }, "-1"),
        React.createElement("button", { onClick: function() { updateMe({ pvCurrent: me.character.pvMax }); }, className: "px-4 py-2 bg-green-200 rounded-lg font-bold" }, "Max"),
        React.createElement("button", { onClick: function() { adjustPv(1); }, className: "px-4 py-2 bg-green-200 rounded-lg font-bold" }, "+1")
      )
    ),
    // Stats
    React.createElement("div", { className: "bg-blue-50 rounded-xl p-4" },
      React.createElement("h4", { className: "font-bold text-gray-700 mb-3" }, "ðŸ“Š Statistiques"),
      React.createElement("div", { className: "grid grid-cols-2 gap-3" },
        Object.entries(STAT_NAMES).map(function(entry) {
          var k = entry[0];
          var n = entry[1];
          var base = me.stats ? (me.stats[k] || 0) : 0;
          var bonus = (me.effects || []).filter(function(e) { return e.stat === k; }).reduce(function(s, e) { return s + e.delta; }, 0);
          return React.createElement("div", { key: k, className: "bg-white rounded-lg p-3 text-center" },
            React.createElement("div", { className: "text-xs text-gray-500" }, n),
            React.createElement("div", { className: "text-xl font-bold" }, 
              base >= 0 ? "+" + base : base,
              bonus !== 0 && React.createElement("span", { className: "text-sm ml-1 " + (bonus > 0 ? 'text-green-600' : 'text-red-600') }, bonus > 0 ? "+" + bonus : bonus)
            )
          );
        })
      )
    ),
    // Ressources
    React.createElement("div", { className: "bg-yellow-50 rounded-xl p-4" },
      React.createElement("h4", { className: "font-bold text-gray-700 mb-3" }, "ðŸ’Ž Ressources"),
      React.createElement("div", { className: "grid grid-cols-2 gap-3" },
        [{ k: 'or', e: 'ðŸ’°' }, { k: 'cuivre', e: 'ðŸŒ³' }, { k: 'argent', e: 'ðŸœï¸' }, { k: 'obsidienne', e: 'â›°ï¸' }].map(function(r) {
          return React.createElement("div", { key: r.k, className: "bg-white rounded-lg p-3 text-center" },
            React.createElement("div", { className: "text-xl" }, r.e),
            React.createElement("div", { className: "text-xl font-bold" }, me[r.k] || 0),
            React.createElement("div", { className: "flex gap-1 justify-center mt-1" },
              React.createElement("button", { onClick: function() { adjustResource(r.k, -1); }, className: "px-2 py-1 bg-gray-200 rounded text-sm" }, "-"),
              React.createElement("button", { onClick: function() { adjustResource(r.k, 1); }, className: "px-2 py-1 bg-gray-200 rounded text-sm" }, "+")
            )
          );
        })
      )
    ),
    // CompÃ©tences
    React.createElement("div", { className: "bg-gray-50 rounded-xl p-4" },
      React.createElement("h4", { className: "font-bold text-gray-700 mb-3" }, "âš”ï¸ CompÃ©tences"),
      React.createElement("div", { className: "space-y-2" },
        (me.skills || []).map(function(s, i) {
          return React.createElement("div", { key: s.id, className: "bg-white rounded-lg p-3 flex items-start gap-2" },
            React.createElement("span", { className: "text-xl" }, i === 0 ? 'ðŸ”®' : i === 1 ? 'âš”ï¸' : 'ðŸ›¡ï¸'),
            React.createElement("p", { className: "text-sm text-gray-700" }, s.description)
          );
        })
      )
    )
  );
}

// PDV Tab
function PdvTab(props) {
  var me = props.me;
  var players = props.players;
  
  var history = me.pdvHistory || [];
  var ranking = players.slice().sort(function(a, b) { return (b.pdv || 0) - (a.pdv || 0); });
  var totalPdv = players.reduce(function(s, p) { return s + (p.pdv || 0); }, 0);
  var targetPdv = players.length * 10;

  var totals = useMemo(function() {
    var sums = {};
    history.forEach(function(e) { sums[e.source] = (sums[e.source] || 0) + e.amount; });
    return sums;
  }, [history]);

  return React.createElement("div", { className: "space-y-6" },
    React.createElement("div", { className: "text-center" },
      React.createElement("h3", { className: "text-2xl font-bold text-gray-800" }, "ðŸ† Points de Victoire"),
      React.createElement("div", { className: "text-5xl font-bold text-yellow-500 my-4" }, me.pdv || 0),
      React.createElement("div", { className: "bg-purple-100 rounded-lg p-3" },
        React.createElement("div", { className: "text-sm text-purple-700 font-bold" }, "Total: " + totalPdv + " / " + targetPdv),
        React.createElement("div", { className: "w-full bg-purple-200 rounded-full h-3 mt-2" },
          React.createElement("div", { className: "bg-purple-600 h-3 rounded-full", style: { width: Math.min(100, (totalPdv / targetPdv) * 100) + "%" } })
        ),
        React.createElement("div", { className: "text-xs text-purple-600 mt-2" }, "ðŸ Fin Ã  " + targetPdv + " PDV")
      )
    ),
    // RÃ©partition
    React.createElement("div", { className: "bg-gray-50 rounded-xl p-4" },
      React.createElement("h4", { className: "font-bold text-gray-700 mb-3" }, "ðŸ“Š RÃ©partition"),
      React.createElement("div", { className: "grid grid-cols-3 gap-2" },
        Object.entries(PDV_SOURCES).map(function(entry) {
          var k = entry[0];
          var info = entry[1];
          return React.createElement("div", { key: k, className: "bg-white rounded-lg p-2 text-center" },
            React.createElement("div", { className: "text-xl" }, info.emoji),
            React.createElement("div", { className: "text-xl font-bold " + info.color }, totals[k] || 0),
            React.createElement("div", { className: "text-xs text-gray-500" }, info.label)
          );
        })
      )
    ),
    // Classement
    React.createElement("div", { className: "bg-gradient-to-r from-purple-600 to-blue-600 rounded-xl p-4 text-white" },
      React.createElement("h4", { className: "font-bold mb-3" }, "ðŸ… Classement"),
      React.createElement("div", { className: "space-y-2" },
        ranking.map(function(p, i) {
          return React.createElement("div", { key: p.oderId || i, className: "flex items-center gap-3 p-2 rounded-lg " + (p.oderId === me.oderId ? 'bg-white bg-opacity-20' : '') },
            React.createElement("span", { className: "text-lg font-bold " + (i === 0 ? 'text-yellow-300' : i === 1 ? 'text-gray-300' : i === 2 ? 'text-orange-300' : '') }, i === 0 ? 'ðŸ¥‡' : i === 1 ? 'ðŸ¥ˆ' : i === 2 ? 'ðŸ¥‰' : '#' + (i + 1)),
            React.createElement("span", { className: "text-xl" }, p.character ? p.character.emoji : ''),
            React.createElement("span", { className: "flex-1" }, p.name),
            React.createElement("span", { className: "font-bold text-xl" }, p.pdv || 0)
          );
        })
      )
    ),
    // Historique
    history.length > 0 && React.createElement("div", null,
      React.createElement("h4", { className: "font-bold text-gray-700 mb-2" }, "ðŸ“œ Historique (" + history.length + ")"),
      React.createElement("div", { className: "space-y-2 max-h-48 overflow-y-auto" },
        history.slice().reverse().map(function(e) {
          var info = PDV_SOURCES[e.source] || PDV_SOURCES.BONUS;
          return React.createElement("div", { key: e.id, className: "flex items-center gap-3 bg-gray-50 rounded-lg p-2" },
            React.createElement("span", { className: "text-xl" }, info.emoji),
            React.createElement("span", { className: "font-bold " + info.color }, "+" + e.amount),
            React.createElement("span", { className: "text-gray-600 text-sm" }, info.label)
          );
        })
      )
    )
  );
}

// Render
createRoot(document.getElementById('root')).render(React.createElement(App));
  </script>
</body>
</html>
